#!/usr/bin/env python3
import pandas as pd
import matplotlib.pyplot as plt
import sys
import glob
import os

# Set the default directory or use the provided argument
dir_path = sys.argv[1] if len(sys.argv) > 1 else 'data'

# Get a list of all CSV files in the specified directory
csv_files = glob.glob(os.path.join(dir_path, '*.csv'))

# Set the number of subplots (you can adjust layout as needed)
num_files = len(csv_files)
cols = 2  # Number of columns of subplots
rows = (num_files // cols) + (num_files % cols > 0)  # Calculate required rows of subplots

# Set up the subplots
fig, axs = plt.subplots(rows, cols, figsize=(10, 5*rows))
axs = axs.ravel()  # Flatten array of axes

# Loop through all CSV files and their corresponding subplot
for i, file in enumerate(csv_files):
    # Load the data from the CSV file
    df = pd.read_csv(file)

    # Convert 'time_taken' to numeric and drop NaN values
    df['time_taken'] = pd.to_numeric(df['time_taken'], errors='coerce')
    df = df.dropna(subset=['time_taken'])

    # Plot a histogram on the corresponding subplot
    axs[i].hist(df['time_taken'], bins=20, edgecolor='k', alpha=0.7)
    axs[i].set_title(f'Histogram of Time Taken ({os.path.basename(file)})')
    axs[i].set_xlabel('Time Taken')
    axs[i].set_ylabel('Count')

# Adjust layout
plt.tight_layout()

# Show the plot
plt.show()
